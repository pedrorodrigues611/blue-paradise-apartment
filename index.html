<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Blue Paradise Apartment by Hoperty</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS Integrado -->
  <style>
    /* ========== CSS BASE ========= */
    body, h1, p, button, span {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    
    body {
      background-color: #f5f8f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      width: 100%;
      max-width: 900px;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    /* ========== Carrossel de imagens (imagem maior) ========== */
    .image-gallery {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin: auto;
    }
    
    .image-gallery .main-image img {
      width: 100%;
      display: block;
      border-radius: 10px;
    }
    
    .image-gallery button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 18px;
      border-radius: 50%;
      transition: background 0.3s;
    }
    
    .image-gallery .prev { left: 10px; }
    .image-gallery .next { right: 10px; }
    
    .image-gallery button:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }
    
    /* ========== Conte√∫do em 2 colunas (Informa√ß√µes / Reserva) ========== */
    .content-wrapper {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .left-column {
      flex: 2;
    }
    
    .right-column {
      flex: 1;
    }
    
    /* ========== Informa√ß√µes da Casa ========== */
    .description {
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .description h1 {
      font-size: 22px;
      color: #333;
    }
    
    .description p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
    }
    
    .details p {
      font-size: 16px;
      color: #666;
      margin-bottom: 10px;
    }
    
    .facilities {
      margin-bottom: 10px;
    }
    
    .facilities button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .facilities button:hover {
      background-color: #0056b3;
    }
    
    #amenities-list {
      display: none;
      margin-top: 10px;
      background: #f1f1f1;
      padding: 10px;
      border-radius: 5px;
    }
    
    .rules {
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
    }
    
    /* Calend√°rio do Google */
    .calendar {
      margin-top: 15px;
      text-align: center;
    }
    
    .calendar iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 5px;
    }
    
    /* ========== Booking Container (Reserva) ========== */
    .booking-container {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
    }
    
    .booking-container .price {
      font-size: 22px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
    }
    
    .booking-container label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    
    .booking-container select,
    .booking-container input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    
    .booking-container button.reserve-btn {
      width: 100%;
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      border-radius: 5px;
      transition: background 0.3s;
    }
    
    .booking-container button.reserve-btn:hover {
      background-color: #218838;
    }
    
    /* Bot√£o para abrir o Date Picker */
    .booking-container button#selectDatesBtn {
      width: 100%;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s;
      margin-top: 10px;
    }
    
    .booking-container button#selectDatesBtn:hover {
      background-color: #0056b3;
    }
    
    /* ========== Date Picker Customizado ========== */
    .date-picker-container {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      width: 300px;
      margin-top: 10px;
      display: none;
      position: absolute;
      z-index: 999;
      top: 120%;
      left: 0;
    }
    
    .date-picker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .date-picker-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
    }
    
    .date-picker-day {
      width: 30px;
      height: 30px;
      line-height: 30px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }
    
    .date-picker-day:hover {
      background-color: #ddd;
    }
    
    .disabled-day {
      background-color: #f1f1f1;
      color: #ccc;
      cursor: not-allowed;
    }
    
    .selected-day {
      background-color: #28a745;
      color: white;
    }
    
    .range-day {
      background-color: #c3e6cb;
    }
    
    /* ========== Resumo e Breakdown ========== */
    .resumo-container,
    .breakdown-container {
      margin-top: 15px;
      padding: 10px;
      background: #f1f1f1;
      border-radius: 6px;
      display: none;
    }
    
    .resumo-container p,
    .breakdown-container p {
      margin: 5px 0;
      font-size: 14px;
    }
    
    /* Link para "Ver detalhes / Ocultar" */
    .toggle-detalhes {
      display: inline-block;
      margin-top: 10px;
      color: #007bff;
      cursor: pointer;
      text-decoration: underline;
      font-size: 14px;
    }
    
    /* Bot√£o fechar (X) para os containers */
    .close-btn {
      background: #ccc;
      color: #333;
      border: none;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      float: right;
    }
    
    .close-btn:hover {
      background: #bbb;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Carrossel de imagens (imagem maior) -->
    <div class="image-gallery">
      <button class="prev">&#10094;</button>
      <div class="main-image">
        <img src="https://i.imgur.com/h9vIQpq.jpeg" alt="Blue Paradise Apartment">
      </div>
      <button class="next">&#10095;</button>
    </div>
    
    <!-- Divis√£o em 2 colunas: Informa√ß√µes da Casa (esquerda) e Reserva (direita) -->
    <div class="content-wrapper">
      <!-- Coluna Esquerda: Informa√ß√µes da Casa -->
      <div class="left-column">
        <div class="description">
          <h1>Blue Paradise Apartment by Hoperty</h1>
          <p>
            O Blue Paradise Apartment est√° localizado no Cani√ßo. Este apartamento √© novo, espa√ßoso e moderno, com muita luz natural, vista parcial para o mar e um amplo p√°tio.
            Est√° bem localizado: restaurantes, padarias e bares a poucos passos, praia a 5 minutos a p√©, Funchal a 10 minutos de carro e pr√≥ximo do aeroporto.
            Supermercado e cafeteria no mesmo pr√©dio.
          </p>
          <p>
            ‚úî 2 Quartos confort√°veis <br>
            ‚úî 2 Banheiros modernos <br>
            ‚úî Cozinha totalmente equipada <br>
            ‚úî Wi-Fi gratuito e TV a cabo <br>
            ‚úî Sacada com vista incr√≠vel <br>
            ‚úî Localiza√ß√£o privilegiada
          </p>
        </div>
        
        <div class="details">
          <p>Funchal - 4 h√≥spedes - 2 quartos - 2 banheiros</p>
          <div class="facilities">
            <p>üçΩ Cozinha &nbsp; üî• Forno &nbsp; üåø Jardim</p>
            <button id="show-amenities">Mostrar todas as 10 comodidades</button>
            <div id="amenities-list" style="display:none;">
              <p>‚úî Wi-Fi r√°pido &nbsp; ‚úî Ar Condicionado &nbsp; ‚úî M√°quina de Lavar</p>
              <p>‚úî Piscina &nbsp; ‚úî TV a Cabo &nbsp; ‚úî Estacionamento</p>
            </div>
          </div>
          <div class="rules">
            <p>‚úî Check-in: 15h &nbsp; ‚úî Check-out: 11h</p>
            <p>‚úî Crian√ßas permitido &nbsp; ‚ùå Fumar n√£o permitido</p>
          </div>
          
          <!-- Calend√°rio do Google -->
          <div class="calendar">
            <h3>Disponibilidade</h3>
            <iframe src="https://calendar.google.com/calendar/embed?
src=c4qe8v081ip4g6hfb5v5i99j9jfafsfb%40import.calendar.google.com
&src=gq3m477imq71fcv56kojh45833nphv7r%40import.calendar.google.com
&ctz=Europe%2FLisbon" 
                    style="border: 0" 
                    width="100%" 
                    height="400" 
                    frameborder="0" 
                    scrolling="no">
            </iframe>
          </div>
        </div>
      </div>
      
      <!-- Coluna Direita: Container de Reserva -->
      <div class="right-column">
        <div class="booking-container">
          <div class="price">‚Ç¨120/noite</div>
          
          <!-- Inputs originais ocultos -->
          <label for="checkin" style="display:none;">Check-in</label>
          <input type="date" id="checkin" style="display:none;">
          <label for="checkout" style="display:none;">Check-out</label>
          <input type="date" id="checkout" style="display:none;">
  
          <!-- Bot√£o para abrir o Date Picker customizado -->
          <button id="selectDatesBtn">Selecionar Datas</button>
          <div class="date-picker-container" id="customDatePicker"></div>
  
          <!-- Sele√ß√£o de n√∫mero de h√≥spedes -->
          <label for="guests" style="margin-top:10px;">N¬∫ de h√≥spedes</label>
          <select id="guests">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
          </select>
  
          <!-- Resumo (aparece ap√≥s selecionar datas) -->
          <div class="resumo-container" id="resumoContainer">
            <span id="closeResumo" class="close-btn">x</span>
            <p id="resumoText"></p>
            <!-- Link para alternar Ver Detalhes / Ocultar -->
            <span id="toggleDetalhes" class="toggle-detalhes">Ver detalhes</span>
          </div>
  
          <!-- Breakdown (detalhamento dos pre√ßos) -->
          <div class="breakdown-container" id="breakdownContainer">
            <span id="closeBreakdown" class="close-btn">x</span>
            <p id="breakdownText"></p>
          </div>
  
          <!-- Bot√£o de reservar -->
          <button class="reserve-btn" id="reserveBtn" style="display:none;">Reservar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ========== SCRIPTS ========== -->
  <script>
    /********************************************
     * SCRIPT BASE (Carrossel, Amenities)
     ********************************************/
    document.addEventListener("DOMContentLoaded", function() {
      // Carrossel de imagens
      let currentImageIndex = 0;
      const images = [
        "https://i.imgur.com/h9vIQpq.jpeg",
        "https://i.imgur.com/BgggDFV.jpeg",
        "https://imgur.com/Fe8ECNE.jpeg",
        "https://imgur.com/rVkhRc4.jpeg",
        "https://imgur.com/JpITN8m.jpeg"
      ];
      const mainImage = document.querySelector(".main-image img");
      const nextButton = document.querySelector(".next");
      const prevButton = document.querySelector(".prev");

      function updateImage() {
        mainImage.src = images[currentImageIndex];
      }

      nextButton.addEventListener("click", function() {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        updateImage();
      });

      prevButton.addEventListener("click", function() {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        updateImage();
      });

      // Mostrar/Esconder comodidades
      const showAmenitiesBtn = document.getElementById("show-amenities");
      const amenitiesList = document.getElementById("amenities-list");
      showAmenitiesBtn.addEventListener("click", function() {
        if (amenitiesList.style.display === "none") {
          amenitiesList.style.display = "block";
        } else {
          amenitiesList.style.display = "none";
        }
      });
    });

    /****************************************************
     * L√ìGICA DAS DATAS OCUPADAS (Google Calendar)
     ****************************************************/
    const calendarId1 = "c4qe8v081ip4g6hfb5v5i99j9jfafsfb@import.calendar.google.com";
    const calendarId2 = "gq3m477imq71fcv56kojh45833nphv7r@import.calendar.google.com";
    const apiKey = "SUA_API_KEY"; // Substituir pela sua API Key

    async function getBookedDates() {
      let events = [];
      const urls = [
        `https://www.googleapis.com/calendar/v3/calendars/${calendarId1}/events?key=${apiKey}`,
        `https://www.googleapis.com/calendar/v3/calendars/${calendarId2}/events?key=${apiKey}`
      ];

      for (let url of urls) {
        let response = await fetch(url);
        let data = await response.json();
        if (data.items) {
          data.items.forEach(event => {
            if (event.start && event.start.date) {
              events.push(event.start.date);
            }
          });
        }
      }
      return events;
    }

    /****************************************************
     * DATE PICKER CUSTOMIZADO
     ****************************************************/
    const selectDatesBtn = document.getElementById("selectDatesBtn");
    const datePickerContainer = document.getElementById("customDatePicker");

    let selectedCheckin = null;
    let selectedCheckout = null;
    let bookedDatesGlobal = [];

    selectDatesBtn.addEventListener("click", () => {
      if (datePickerContainer.style.display === "none" || datePickerContainer.style.display === "") {
        datePickerContainer.style.display = "block";
        generateCalendar(new Date().getFullYear(), new Date().getMonth());
      } else {
        datePickerContainer.style.display = "none";
      }
    });

    async function generateCalendar(year, month) {
      if (bookedDatesGlobal.length === 0) {
        bookedDatesGlobal = await getBookedDates();
      }
      datePickerContainer.innerHTML = "";

      const headerDiv = document.createElement("div");
      headerDiv.className = "date-picker-header";

      const monthNames = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho",
                          "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
      const title = document.createElement("span");
      title.textContent = `${monthNames[month]} ${year}`;
      headerDiv.appendChild(title);
      datePickerContainer.appendChild(headerDiv);

      const gridDiv = document.createElement("div");
      gridDiv.className = "date-picker-grid";

      const daysOfWeek = ["D","S","T","Q","Q","S","S"];
      daysOfWeek.forEach(d => {
        const cell = document.createElement("div");
        cell.style.fontWeight = "bold";
        cell.textContent = d;
        gridDiv.appendChild(cell);
      });

      let firstDay = new Date(year, month, 1);
      let startDay = firstDay.getDay();

      for (let i = 0; i < startDay; i++) {
        const emptyCell = document.createElement("div");
        gridDiv.appendChild(emptyCell);
      }

      const daysInMonth = new Date(year, month+1, 0).getDate();

      for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement("div");
        cell.className = "date-picker-day";
        cell.textContent = day;

        const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;

        if (bookedDatesGlobal.includes(dateStr)) {
          cell.classList.add("disabled-day");
        } else {
          cell.addEventListener("click", () => handleDateSelection(dateStr, cell));
        }

        if (selectedCheckin === dateStr || selectedCheckout === dateStr) {
          cell.classList.add("selected-day");
        } else if (isInRange(dateStr, selectedCheckin, selectedCheckout)) {
          cell.classList.add("range-day");
        }
        gridDiv.appendChild(cell);
      }
      datePickerContainer.appendChild(gridDiv);
    }

    function isInRange(dateStr, checkin, checkout) {
      if (!checkin || !checkout) return false;
      const d = new Date(dateStr);
      const cIn = new Date(checkin);
      const cOut = new Date(checkout);
      return d >= cIn && d <= cOut;
    }

    function handleDateSelection(dateStr, cell) {
      if (!selectedCheckin) {
        selectedCheckin = dateStr;
        selectedCheckout = null;
      } else if (!selectedCheckout) {
        if (new Date(dateStr) <= new Date(selectedCheckin)) {
          alert("O checkout deve ser depois do check-in!");
          return;
        }
        const nights = calculateNights(selectedCheckin, dateStr);
        if (nights < 4) {
          alert("√â necess√°rio um m√≠nimo de 4 noites.");
          return;
        }
        selectedCheckout = dateStr;
        datePickerContainer.style.display = "none";
        showResumo();
      } else {
        selectedCheckin = dateStr;
        selectedCheckout = null;
      }
      generateCalendar(new Date().getFullYear(), new Date().getMonth());
    }

    function calculateNights(checkin, checkout) {
      const cIn = new Date(checkin);
      const cOut = new Date(checkout);
      return (cOut - cIn) / (1000 * 3600 * 24);
    }

    /****************************************************
     * RESUMO E BREAKDOWN
     ****************************************************/
    const resumoContainer = document.getElementById("resumoContainer");
    const resumoText = document.getElementById("resumoText");
    const closeResumo = document.getElementById("closeResumo");

    function showResumo() {
      const nights = calculateNights(selectedCheckin, selectedCheckout);
      resumoText.textContent = `Selecionaste ${nights} noites: de ${selectedCheckin} at√© ${selectedCheckout}.`;
      resumoContainer.style.display = "block";
      document.getElementById("reserveBtn").style.display = "block";
      // Garante que o link de detalhes inicia como "Ver detalhes"
      document.getElementById("toggleDetalhes").textContent = "Ver detalhes";
      document.getElementById("breakdownContainer").style.display = "none";
    }

    closeResumo.addEventListener("click", () => {
      resumoContainer.style.display = "none";
    });

    const toggleDetalhes = document.getElementById("toggleDetalhes");
    const breakdownContainer = document.getElementById("breakdownContainer");
    const breakdownText = document.getElementById("breakdownText");
    const closeBreakdown = document.getElementById("closeBreakdown");

    toggleDetalhes.addEventListener("click", () => {
      if (breakdownContainer.style.display === "block") {
        breakdownContainer.style.display = "none";
        toggleDetalhes.textContent = "Ver detalhes";
      } else {
        const nights = calculateNights(selectedCheckin, selectedCheckout);
        const baseRate = 120;
        let nightsCost = baseRate * nights;
        const cleaningFee = 50;
        let discount = 0;
        if (nights > 7) {
          discount = 0.04 * nightsCost;
        }
        const total = nightsCost - discount + cleaningFee;
        breakdownText.innerHTML = `
          <p><strong>Noites:</strong> ${nights} x 120‚Ç¨ = ${nightsCost.toFixed(2)}‚Ç¨</p>
          ${discount > 0 ? `<p><strong>Desconto (4%):</strong> -${discount.toFixed(2)}‚Ç¨</p>` : ""}
          <p><strong>Taxa de Limpeza:</strong> 50‚Ç¨</p>
          <hr>
          <p><strong>Total:</strong> ${total.toFixed(2)}‚Ç¨</p>
        `;
        breakdownContainer.style.display = "block";
        toggleDetalhes.textContent = "Ocultar";
      }
    });

    closeBreakdown.addEventListener("click", () => {
      breakdownContainer.style.display = "none";
      toggleDetalhes.textContent = "Ver detalhes";
    });

    const reserveBtn = document.getElementById("reserveBtn");
    reserveBtn.addEventListener("click", () => {
      alert("Reserva conclu√≠da!\nCheck-in: " + selectedCheckin +
            "\nCheck-out: " + selectedCheckout +
            "\nH√≥spedes: " + document.getElementById("guests").value);
    });
  </script>
</body>
</html>
